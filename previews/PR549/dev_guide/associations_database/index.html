<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Associations Database Schema · InfrastructureSystems.jl</title><meta name="title" content="Associations Database Schema · InfrastructureSystems.jl"/><meta property="og:title" content="Associations Database Schema · InfrastructureSystems.jl"/><meta property="twitter:title" content="Associations Database Schema · InfrastructureSystems.jl"/><meta name="description" content="Documentation for InfrastructureSystems.jl."/><meta property="og:description" content="Documentation for InfrastructureSystems.jl."/><meta property="twitter:description" content="Documentation for InfrastructureSystems.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="InfrastructureSystems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">InfrastructureSystems.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><span class="tocitem">Developer Guide</span><ul><li><a class="tocitem" href="../components_and_container/">Managing Components</a></li><li><a class="tocitem" href="../auto_generation/">Auto-Generation of Component Structs</a></li><li><a class="tocitem" href="../time_series/">Time Series Data</a></li><li class="is-active"><a class="tocitem" href>Associations Database Schema</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Design-Rationale"><span>Design Rationale</span></a></li><li><a class="tocitem" href="#Time-Series-Metadata-Store"><span>Time Series Metadata Store</span></a></li><li><a class="tocitem" href="#Supplemental-Attribute-Associations"><span>Supplemental Attribute Associations</span></a></li><li><a class="tocitem" href="#Performance-Considerations"><span>Performance Considerations</span></a></li><li><a class="tocitem" href="#Serialization-Behavior"><span>Serialization Behavior</span></a></li><li><a class="tocitem" href="#Implementation-Files"><span>Implementation Files</span></a></li><li><a class="tocitem" href="#Debugging-and-Inspection"><span>Debugging and Inspection</span></a></li><li><a class="tocitem" href="#Best-Practices-for-Developers"><span>Best Practices for Developers</span></a></li><li><a class="tocitem" href="#Future-Considerations"><span>Future Considerations</span></a></li></ul></li><li><a class="tocitem" href="../recorder/">Recorder Events</a></li><li><a class="tocitem" href="../tests/">Running Tests</a></li><li><a class="tocitem" href="../retest_migration/">Migrating Tests to ReTest.jl</a></li><li><a class="tocitem" href="../logging/">Logging</a></li><li><a class="tocitem" href="../test_data_artifacts/">Using Local Test Data with PowerSystemCaseBuilder</a></li></ul></li><li><a class="tocitem" href="../../style/">Style Guide</a></li><li><span class="tocitem">Documentation Best Practices</span><ul><li><a class="tocitem" href="../../docs_best_practices/explanation/">Explanation</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../docs_best_practices/how-to/requirements_checklist/">Complete Basic Requirements Checklist</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/general_formatting/">Clean Up General Formatting</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/write_a_tutorial/">Write a Tutorial</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/write_a_how-to/">Write a How-To Guide</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/write_docstrings_org_api/">Organize APIs and Write Docstrings</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/troubleshoot/">Troubleshoot Common Errors</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/compile/">Compile and View Documentation Locally</a></li><li><a class="tocitem" href="../../docs_best_practices/how-to/view_github/">View Draft Documentation on Github</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../docs_best_practices/reference/useful_links/">Useful Links</a></li></ul></li></ul></li><li><a class="tocitem" href="../../InfrastructureSystems/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Guide</a></li><li class="is-active"><a href>Associations Database Schema</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Associations Database Schema</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NREL-Sienna/InfrastructureSystems.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NREL-Sienna/InfrastructureSystems.jl/blob/main/docs/src/dev_guide/associations_database.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Associations-Database-Schema"><a class="docs-heading-anchor" href="#Associations-Database-Schema">Associations Database Schema</a><a id="Associations-Database-Schema-1"></a><a class="docs-heading-anchor-permalink" href="#Associations-Database-Schema" title="Permalink"></a></h1><div class="admonition is-info" id="For-Maintainers-and-Contributors-ca8e858bf8fd9927"><header class="admonition-header">For Maintainers and Contributors<a class="admonition-anchor" href="#For-Maintainers-and-Contributors-ca8e858bf8fd9927" title="Permalink"></a></header><div class="admonition-body"><p>This page documents the internal database schemas used by InfrastructureSystems.jl to manage associations between components and their time series data and supplemental attributes. This information is intended for maintainers and contributors working on the codebase. <strong>End users should not need to interact with these databases directly.</strong></p></div></div><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>InfrastructureSystems.jl uses SQLite databases to efficiently track associations between:</p><ul><li><strong>Components</strong> and <strong>Time Series data</strong></li><li><strong>Components</strong> and <strong>Supplemental Attributes</strong></li></ul><p>These associations are managed under the hood to enable:</p><ul><li>Fast lookups of time series and attributes attached to components</li><li>Efficient querying and filtering</li><li>Proper lifecycle management (adding, removing, updating references)</li><li>Serialization and deserialization support</li></ul><p>The package maintains two separate databases:</p><ol><li><strong>Time Series Metadata Store</strong> - tracks time series associations</li><li><strong>Supplemental Attribute Associations</strong> - tracks supplemental attribute associations</li></ol><h2 id="Design-Rationale"><a class="docs-heading-anchor" href="#Design-Rationale">Design Rationale</a><a id="Design-Rationale-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Rationale" title="Permalink"></a></h2><h3 id="Why-Separate-Databases?"><a class="docs-heading-anchor" href="#Why-Separate-Databases?">Why Separate Databases?</a><a id="Why-Separate-Databases?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-Separate-Databases?" title="Permalink"></a></h3><p>Time series metadata and supplemental attribute associations are stored in independent SQLite databases rather than different tables in the same database. This design decision is driven by serialization requirements:</p><p><strong>Background:</strong></p><ul><li>Time series metadata is always persisted as a SQLite file during serialization</li><li>The SQLite file is written as an HDF5 dataset in the time series data file</li><li>Serialization produces: <code>system.json</code>, <code>system_metadata.json</code>, and <code>system_time_series.h5</code></li><li>If there is no time series in the system, only <code>system.json</code> and <code>system_metadata.json</code> are produced</li></ul><p><strong>The Problem:</strong> If supplemental attribute associations were in the same database as time series metadata, and the system had supplemental attributes but no time series, serialization would produce an extra file. The team required that supplemental attribute associations be written to the system JSON file when there is no time series data.</p><p><strong>The Solution:</strong> Keeping them as separate databases simplifies the code by avoiding the complexity of temporarily sharing a database across serialization and deepcopy operations. The supplemental attribute database is always ephemeral (in-memory only), while the time series metadata can be persisted.</p><h2 id="Time-Series-Metadata-Store"><a class="docs-heading-anchor" href="#Time-Series-Metadata-Store">Time Series Metadata Store</a><a id="Time-Series-Metadata-Store-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Series-Metadata-Store" title="Permalink"></a></h2><p>The <code>TimeSeriesMetadataStore</code> manages associations between time series data and components/supplemental attributes. It uses an in-memory SQLite database for fast access.</p><h3 id="Database-Tables"><a class="docs-heading-anchor" href="#Database-Tables">Database Tables</a><a id="Database-Tables-1"></a><a class="docs-heading-anchor-permalink" href="#Database-Tables" title="Permalink"></a></h3><h4 id="1.-time_series_associations-Table"><a class="docs-heading-anchor" href="#1.-time_series_associations-Table">1. <code>time_series_associations</code> Table</a><a id="1.-time_series_associations-Table-1"></a><a class="docs-heading-anchor-permalink" href="#1.-time_series_associations-Table" title="Permalink"></a></h4><p>This is the primary table that stores the associations between time series data and owners (components or supplemental attributes).</p><p><strong>Schema:</strong></p><table><tr><th style="text-align: left">Column Name</th><th style="text-align: left">Type</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>id</code></td><td style="text-align: left">INTEGER</td><td style="text-align: left">Primary key, auto-incremented</td></tr><tr><td style="text-align: left"><code>time_series_uuid</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">UUID of the time series data array</td></tr><tr><td style="text-align: left"><code>time_series_type</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Type name of the time series (e.g., &quot;SingleTimeSeries&quot;, &quot;Deterministic&quot;)</td></tr><tr><td style="text-align: left"><code>initial_timestamp</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">ISO 8601 formatted initial timestamp</td></tr><tr><td style="text-align: left"><code>resolution</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Resolution encoded as <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 duration</a></td></tr><tr><td style="text-align: left"><code>horizon</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">ISO 8601 formatted forecast horizon (NULL for static time series)</td></tr><tr><td style="text-align: left"><code>interval</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">ISO 8601 formatted forecast interval (NULL for static time series)</td></tr><tr><td style="text-align: left"><code>window_count</code></td><td style="text-align: left">INTEGER</td><td style="text-align: left">Number of forecast windows (NULL for static time series)</td></tr><tr><td style="text-align: left"><code>length</code></td><td style="text-align: left">INTEGER</td><td style="text-align: left">Length of static time series (NULL for forecasts)</td></tr><tr><td style="text-align: left"><code>name</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">User-defined name for the time series</td></tr><tr><td style="text-align: left"><code>owner_uuid</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">UUID of the component or supplemental attribute that owns this</td></tr><tr><td style="text-align: left"><code>owner_type</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Type name of the owner</td></tr><tr><td style="text-align: left"><code>owner_category</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Either &quot;Component&quot; or &quot;SupplementalAttribute&quot;</td></tr><tr><td style="text-align: left"><code>features</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">JSON string of feature key-value pairs for filtering</td></tr><tr><td style="text-align: left"><code>scaling_factor_multiplier</code></td><td style="text-align: left">JSON</td><td style="text-align: left">Optional function for scaling (NULL if not used)</td></tr><tr><td style="text-align: left"><code>metadata_uuid</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">UUID of the metadata object</td></tr><tr><td style="text-align: left"><code>units</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Optional units specification (NULL if not used)</td></tr></table><p><strong>Indexes:</strong></p><ul><li><code>by_c_n_tst_features</code>: Composite index on <code>(owner_uuid, time_series_type, name, resolution, features)</code> - optimized for lookups by component with specific time series parameters</li><li><code>by_ts_uuid</code>: Index on <code>(time_series_uuid)</code> - optimized for finding all owners of a specific time series</li></ul><p><strong>Design Notes:</strong></p><ul><li>The table supports both static time series and forecasts. Forecast-specific columns (<code>horizon</code>, <code>interval</code>, <code>window_count</code>) are NULL for static time series.</li><li>The <code>features</code> column stores a JSON string of key-value pairs that can be used for flexible filtering and querying.</li><li>All <code>Dates.Period</code> values are stored as ISO 8601 strings for portability.</li><li>The <code>metadata_uuid</code> allows multiple associations to reference the same metadata object (stored in memory).</li></ul><h4 id="2.-key_value_store-Table"><a class="docs-heading-anchor" href="#2.-key_value_store-Table">2. <code>key_value_store</code> Table</a><a id="2.-key_value_store-Table-1"></a><a class="docs-heading-anchor-permalink" href="#2.-key_value_store-Table" title="Permalink"></a></h4><p>Stores metadata about the database itself.</p><p><strong>Schema:</strong></p><table><tr><th style="text-align: left">Column Name</th><th style="text-align: left">Type</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>key</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Primary key</td></tr><tr><td style="text-align: left"><code>value</code></td><td style="text-align: left">JSON</td><td style="text-align: left">JSON value</td></tr></table><p><strong>Current Keys:</strong></p><ul><li><code>version</code>: Stores the time series metadata format version (currently &quot;1.0.0&quot;)</li></ul><h3 id="Common-Queries"><a class="docs-heading-anchor" href="#Common-Queries">Common Queries</a><a id="Common-Queries-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Queries" title="Permalink"></a></h3><p>The following types of queries are optimized by the indexes:</p><ol><li><p><strong>Find all time series for a component:</strong></p><pre><code class="language-sql hljs">SELECT * FROM time_series_associations WHERE owner_uuid = ?</code></pre></li><li><p><strong>Find specific time series by name and type:</strong></p><pre><code class="language-sql hljs">SELECT * FROM time_series_associations 
WHERE owner_uuid = ? AND name = ? AND time_series_type = ?</code></pre></li><li><p><strong>Find time series with specific features:</strong></p><pre><code class="language-sql hljs">SELECT * FROM time_series_associations 
WHERE owner_uuid = ? AND features LIKE ?</code></pre></li><li><p><strong>Find all owners of a time series:</strong></p><pre><code class="language-sql hljs">SELECT DISTINCT owner_uuid FROM time_series_associations 
WHERE time_series_uuid = ?</code></pre></li></ol><h3 id="Migrations"><a class="docs-heading-anchor" href="#Migrations">Migrations</a><a id="Migrations-1"></a><a class="docs-heading-anchor-permalink" href="#Migrations" title="Permalink"></a></h3><p>The database schema has evolved over time. Migration code handles upgrading from older formats:</p><ul><li><strong>v2.3 Migration</strong>: Converted from a single metadata table with JSON columns to the current two-table structure</li><li><strong>v2.4 Migration</strong>: Converted period storage from integer milliseconds to ISO 8601 strings</li></ul><p>Migration functions (<code>_migrate_from_v2_3</code>, <code>_migrate_from_v2_4</code>) are maintained in <code>time_series_metadata_store.jl</code> for backward compatibility.</p><h2 id="Supplemental-Attribute-Associations"><a class="docs-heading-anchor" href="#Supplemental-Attribute-Associations">Supplemental Attribute Associations</a><a id="Supplemental-Attribute-Associations-1"></a><a class="docs-heading-anchor-permalink" href="#Supplemental-Attribute-Associations" title="Permalink"></a></h2><p>The <code>SupplementalAttributeAssociations</code> manages associations between supplemental attributes and components. It uses an in-memory SQLite database that is always ephemeral.</p><h3 id="Database-Table"><a class="docs-heading-anchor" href="#Database-Table">Database Table</a><a id="Database-Table-1"></a><a class="docs-heading-anchor-permalink" href="#Database-Table" title="Permalink"></a></h3><h4 id="supplemental_attributes-Table"><a class="docs-heading-anchor" href="#supplemental_attributes-Table"><code>supplemental_attributes</code> Table</a><a id="supplemental_attributes-Table-1"></a><a class="docs-heading-anchor-permalink" href="#supplemental_attributes-Table" title="Permalink"></a></h4><p><strong>Schema:</strong></p><table><tr><th style="text-align: left">Column Name</th><th style="text-align: left">Type</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>attribute_uuid</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">UUID of the supplemental attribute</td></tr><tr><td style="text-align: left"><code>attribute_type</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Type name of the supplemental attribute</td></tr><tr><td style="text-align: left"><code>component_uuid</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">UUID of the component</td></tr><tr><td style="text-align: left"><code>component_type</code></td><td style="text-align: left">TEXT</td><td style="text-align: left">Type name of the component</td></tr></table><p><strong>Indexes:</strong></p><ul><li><code>by_attribute</code>: Composite index on <code>(attribute_uuid, component_uuid, component_type)</code> - optimized for finding components associated with an attribute</li><li><code>by_component</code>: Composite index on <code>(component_uuid, attribute_uuid, attribute_type)</code> - optimized for finding attributes associated with a component</li></ul><p><strong>Design Notes:</strong></p><ul><li>The schema is simpler than the time series associations because supplemental attributes have less metadata</li><li>Both attribute and component information is stored to enable bidirectional lookups</li><li>The indexes support fast queries in both directions (attribute → components and component → attributes)</li></ul><h3 id="Common-Queries-2"><a class="docs-heading-anchor" href="#Common-Queries-2">Common Queries</a><a class="docs-heading-anchor-permalink" href="#Common-Queries-2" title="Permalink"></a></h3><ol><li><p><strong>Find all attributes for a component:</strong></p><pre><code class="language-sql hljs">SELECT DISTINCT attribute_uuid FROM supplemental_attributes 
WHERE component_uuid = ?</code></pre></li><li><p><strong>Find attributes of a specific type for a component:</strong></p><pre><code class="language-sql hljs">SELECT DISTINCT attribute_uuid FROM supplemental_attributes 
WHERE component_uuid = ? AND attribute_type = ?</code></pre></li><li><p><strong>Find all components with an attribute:</strong></p><pre><code class="language-sql hljs">SELECT DISTINCT component_uuid FROM supplemental_attributes 
WHERE attribute_uuid = ?</code></pre></li><li><p><strong>Check if an association exists:</strong></p><pre><code class="language-sql hljs">SELECT attribute_uuid FROM supplemental_attributes 
WHERE attribute_uuid = ? AND component_uuid = ? 
LIMIT 1</code></pre></li></ol><h2 id="Performance-Considerations"><a class="docs-heading-anchor" href="#Performance-Considerations">Performance Considerations</a><a id="Performance-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Considerations" title="Permalink"></a></h2><h3 id="Statement-Caching"><a class="docs-heading-anchor" href="#Statement-Caching">Statement Caching</a><a id="Statement-Caching-1"></a><a class="docs-heading-anchor-permalink" href="#Statement-Caching" title="Permalink"></a></h3><p>Both database implementations cache compiled SQL statements to avoid the overhead of re-parsing queries. This saves approximately 3-4 microseconds per query.</p><ul><li><code>TimeSeriesMetadataStore</code> maintains a <code>cached_statements</code> dictionary</li><li><code>SupplementalAttributeAssociations</code> maintains a <code>cached_statements</code> dictionary</li><li>Frequently-used queries benefit most from caching</li></ul><h3 id="Index-Strategy"><a class="docs-heading-anchor" href="#Index-Strategy">Index Strategy</a><a id="Index-Strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Index-Strategy" title="Permalink"></a></h3><p><strong>Time Series Metadata:</strong></p><ol><li>Optimize for user queries by component/attribute UUID with name, type, and resolution</li><li>Optimize for deduplication checks during <code>add_time_series!</code></li><li>Optimize for metadata retrieval by time series UUID</li></ol><p><strong>Supplemental Attributes:</strong></p><ol><li>Optimize for bidirectional lookups (attribute ↔ component)</li><li>Support filtering by type in both directions</li></ol><h3 id="Database-Location"><a class="docs-heading-anchor" href="#Database-Location">Database Location</a><a id="Database-Location-1"></a><a class="docs-heading-anchor-permalink" href="#Database-Location" title="Permalink"></a></h3><ul><li>Both databases are in-memory (<code>SQLite.DB()</code>) for performance</li><li>The time series metadata database can be backed up to disk for serialization</li><li>The supplemental attribute database is never persisted (associations are stored in JSON during serialization)</li></ul><h2 id="Serialization-Behavior"><a class="docs-heading-anchor" href="#Serialization-Behavior">Serialization Behavior</a><a id="Serialization-Behavior-1"></a><a class="docs-heading-anchor-permalink" href="#Serialization-Behavior" title="Permalink"></a></h2><h3 id="Time-Series-Metadata"><a class="docs-heading-anchor" href="#Time-Series-Metadata">Time Series Metadata</a><a id="Time-Series-Metadata-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Series-Metadata" title="Permalink"></a></h3><p>During serialization:</p><ol><li>The in-memory database is backed up to a temporary file</li><li>Indexes are dropped from the backup (to reduce file size)</li><li>The database file is written as an HDF5 dataset in <code>system_time_series.h5</code></li></ol><p>During deserialization:</p><ol><li>The SQLite database is extracted from the HDF5 file</li><li>It&#39;s loaded into an in-memory database</li><li>Indexes are recreated for performance</li><li>Metadata objects are reconstructed and cached in memory</li></ol><h3 id="Supplemental-Attribute-Associations-2"><a class="docs-heading-anchor" href="#Supplemental-Attribute-Associations-2">Supplemental Attribute Associations</a><a class="docs-heading-anchor-permalink" href="#Supplemental-Attribute-Associations-2" title="Permalink"></a></h3><p>During serialization:</p><ol><li>All associations are extracted as records (tuples of UUIDs and types)</li><li>Records are written to the JSON file</li></ol><p>During deserialization:</p><ol><li>Records are read from the JSON file</li><li>A new in-memory database is created</li><li>Records are bulk-inserted using <code>executemany</code> for efficiency</li><li>Indexes are created</li></ol><h2 id="Implementation-Files"><a class="docs-heading-anchor" href="#Implementation-Files">Implementation Files</a><a id="Implementation-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-Files" title="Permalink"></a></h2><ul><li><strong>Time Series Metadata Store</strong>: <a href="https://github.com/NREL-Sienna/InfrastructureSystems.jl/blob/main/src/time_series_metadata_store.jl"><code>src/time_series_metadata_store.jl</code></a></li><li><strong>Supplemental Attribute Associations</strong>: <a href="https://github.com/NREL-Sienna/InfrastructureSystems.jl/blob/main/src/supplemental_attribute_associations.jl"><code>src/supplemental_attribute_associations.jl</code></a></li><li><strong>SQLite Utilities</strong>: <a href="https://github.com/NREL-Sienna/InfrastructureSystems.jl/blob/main/src/utils/sqlite.jl"><code>src/utils/sqlite.jl</code></a></li></ul><h2 id="Debugging-and-Inspection"><a class="docs-heading-anchor" href="#Debugging-and-Inspection">Debugging and Inspection</a><a id="Debugging-and-Inspection-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-and-Inspection" title="Permalink"></a></h2><h3 id="Querying-the-Databases"><a class="docs-heading-anchor" href="#Querying-the-Databases">Querying the Databases</a><a id="Querying-the-Databases-1"></a><a class="docs-heading-anchor-permalink" href="#Querying-the-Databases" title="Permalink"></a></h3><p>Both stores provide a <code>sql()</code> function for running custom queries:</p><pre><code class="language-julia hljs"># Query time series associations
df = InfrastructureSystems.sql(
    store,
    &quot;SELECT * FROM time_series_associations WHERE owner_type = &#39;Generator&#39;&quot;,
)

# Query supplemental attribute associations  
df = InfrastructureSystems.sql(
    associations,
    &quot;SELECT * FROM supplemental_attributes WHERE component_type = &#39;Bus&#39;&quot;,
)</code></pre><h3 id="Viewing-as-DataFrames"><a class="docs-heading-anchor" href="#Viewing-as-DataFrames">Viewing as DataFrames</a><a id="Viewing-as-DataFrames-1"></a><a class="docs-heading-anchor-permalink" href="#Viewing-as-DataFrames" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Time series associations as DataFrame
df = InfrastructureSystems.to_dataframe(store)

# Supplemental attributes as records
records = InfrastructureSystems.to_records(associations)</code></pre><h3 id="Summary-Functions"><a class="docs-heading-anchor" href="#Summary-Functions">Summary Functions</a><a id="Summary-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-Functions" title="Permalink"></a></h3><p>Both stores provide summary functions:</p><pre><code class="language-julia hljs"># Time series summaries
counts = InfrastructureSystems.get_time_series_counts(store)
summary_table = InfrastructureSystems.get_forecast_summary_table(store)

# Supplemental attribute summaries
summary_table = InfrastructureSystems.get_attribute_summary_table(associations)
num_attrs = InfrastructureSystems.get_num_attributes(associations)</code></pre><h2 id="Best-Practices-for-Developers"><a class="docs-heading-anchor" href="#Best-Practices-for-Developers">Best Practices for Developers</a><a id="Best-Practices-for-Developers-1"></a><a class="docs-heading-anchor-permalink" href="#Best-Practices-for-Developers" title="Permalink"></a></h2><ol><li><p><strong>Use Transactions</strong>: When making multiple related changes, wrap them in a SQLite transaction for atomicity and performance</p></li><li><p><strong>Leverage Indexes</strong>: Design queries to take advantage of the existing indexes. Check query plans if performance is a concern.</p></li><li><p><strong>Cache Statements</strong>: For frequently-executed queries, use the cached statement methods (<code>_execute_cached</code>) rather than creating new statements each time</p></li><li><p><strong>Validate Migrations</strong>: When modifying the schema, ensure migration code is added and tested with data from older versions</p></li><li><p><strong>Test with Large Datasets</strong>: Performance characteristics can change significantly with large numbers of associations. Test with realistic data sizes.</p></li><li><p><strong>Handle Edge Cases</strong>: Consider abstract types, subtypes, and empty result sets in query logic</p></li><li><p><strong>Maintain Consistency</strong>: When adding/removing associations, ensure both the database and any in-memory caches (like <code>metadata_uuids</code> in TimeSeriesMetadataStore) are updated together</p></li></ol><h2 id="Future-Considerations"><a class="docs-heading-anchor" href="#Future-Considerations">Future Considerations</a><a id="Future-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Future-Considerations" title="Permalink"></a></h2><p>Potential areas for enhancement:</p><ul><li><strong>Query Optimization</strong>: Profile and optimize hot paths, especially for large systems</li><li><strong>Schema Versioning</strong>: Maintain a clear versioning strategy as the schema evolves</li><li><strong>Partial Indexes</strong>: Consider partial indexes for common filtered queries</li><li><strong>Bulk Operations</strong>: Optimize bulk insert/delete operations for large datasets</li><li><strong>Foreign Keys</strong>: Currently not used; could add foreign key constraints for data integrity if needed</li><li><strong>Full-Text Search</strong>: For advanced filtering on text fields like <code>name</code> or <code>features</code></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../time_series/">« Time Series Data</a><a class="docs-footer-nextpage" href="../recorder/">Recorder Events »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 4 February 2026 01:34">Wednesday 4 February 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
