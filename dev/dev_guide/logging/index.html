<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Logging · InfrastructureSystems.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">InfrastructureSystems.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><span class="tocitem">Developer Guide</span><ul><li><a class="tocitem" href="../components_and_container/">Managing Components</a></li><li><a class="tocitem" href="../auto_generation/">Auto-Generation of Component Structs</a></li><li><a class="tocitem" href="../time_series/">Time Series Data</a></li><li><a class="tocitem" href="../recorder/">Recorder Events</a></li><li><a class="tocitem" href="../tests/">Running Tests</a></li><li class="is-active"><a class="tocitem" href>Logging</a><ul class="internal"><li><a class="tocitem" href="#Use-Cases"><span>Use Cases</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../style/">Style Guide</a></li><li><a class="tocitem" href="../../InfrastructureSystems/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Guide</a></li><li class="is-active"><a href>Logging</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Logging</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-SIIP/InfrastructureSystems.jl/blob/master/docs/src/dev_guide/logging.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Logging"><a class="docs-heading-anchor" href="#Logging">Logging</a><a id="Logging-1"></a><a class="docs-heading-anchor-permalink" href="#Logging" title="Permalink"></a></h1><p><code>InfrastructureSystems.jl</code> provides a <code>MultiLogger</code> object that allows customized logging to console and file. Refer to the <a href>logging documentation</a>.</p><p>If you want to create a package-specific log file during a simulation, consider the workflow used by <a href="https://github.com/NREL-SIIP/PowerSimulations.jl">PowerSimulations.jl</a>. It creates a custom logger in its <code>build!(Simulation)</code> function and then uses Julia&#39;s <code>Logging.with_logger</code> function to temporarily take over the global logger during <code>build()</code> and <code>execute()</code>.</p><p>This document describes logging facilities available in the modules that use <code>InfrastructureSystems.jl</code>. The examples assume the following imports:</p><pre><code class="language-julia">import Logging
import InfrastructureSystems:
    configure_logging,
    open_file_logger,
    MultiLogger,
    LogEventTracker,
    make_logging_config_file,
    report_log_summary</code></pre><p><strong>Note</strong>: Packages that depend on <code>InfrastructureSystems.jl</code> already re-export <code>configure_logging</code>, <code>open_file_logger</code>, <code>MultiLogger</code>, <code>LogEventTracker</code></p><h2 id="Use-Cases"><a class="docs-heading-anchor" href="#Use-Cases">Use Cases</a><a id="Use-Cases-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Cases" title="Permalink"></a></h2><h3 id="Enable-logging-in-REPL-or-Jupyter-Notebook"><a class="docs-heading-anchor" href="#Enable-logging-in-REPL-or-Jupyter-Notebook">Enable logging in REPL or Jupyter Notebook</a><a id="Enable-logging-in-REPL-or-Jupyter-Notebook-1"></a><a class="docs-heading-anchor-permalink" href="#Enable-logging-in-REPL-or-Jupyter-Notebook" title="Permalink"></a></h3><p>Use <a href="../../InfrastructureSystems/#InfrastructureSystems.configure_logging-Tuple{}"><code>InfrastructureSystems.configure_logging</code></a> to create a logger with your preferences (console and/or file, levels, etc.).</p><p><strong>Note:</strong> log messages are not automatically flushed to files. Call <code>flush(logger)</code> to make this happen.</p><p><strong>Example</strong>: Global logger configuration</p><pre><code class="language-julia">logger = configure_logging(; filename=&quot;log.txt&quot;)
@info &quot;hello world&quot;
flush(logger)
@error &quot;some error&quot;
close(logger)</code></pre><p>You can also configure logging from a configuration file.</p><pre><code class="language-julia">make_logging_config_file(&quot;logging_config.toml&quot;)
# Customize in an editor.
logger = configure_logging(&quot;logging_config.toml&quot;)</code></pre><h3 id="Enable-debug-logging-for-code-you-are-debugging-but-not-for-noisy-areas-you-don&#39;t-care-about."><a class="docs-heading-anchor" href="#Enable-debug-logging-for-code-you-are-debugging-but-not-for-noisy-areas-you-don&#39;t-care-about.">Enable debug logging for code you are debugging but not for noisy areas you don&#39;t care about.</a><a id="Enable-debug-logging-for-code-you-are-debugging-but-not-for-noisy-areas-you-don&#39;t-care-about.-1"></a><a class="docs-heading-anchor-permalink" href="#Enable-debug-logging-for-code-you-are-debugging-but-not-for-noisy-areas-you-don&#39;t-care-about." title="Permalink"></a></h3><p>InfrastructureSystems uses the <code>_group</code> field of a log event to perform additional filtering. All debug log messages that run frequently should have this field defined.</p><p>Note that the default value of <code>_group</code> for a log event is its filename. Refer to the <a href="https://docs.julialang.org/en/v1/stdlib/Logging/#Log-event-structure">Julia docs</a> for more information.</p><p>Run this in the REPL to see commonly-used groups in InfrastructureSystems:</p><pre><code class="language-julia">@show InfrastructureSystems.LOG_GROUPS</code></pre><p>You can tell InfrastructureSystems to filter out messages from a particular group in two ways:</p><ol><li>Specify the group level in the <code>logging_config.toml</code> file mentioned above and configure logging with it.</li><li>Change the logger dynamically from with Julia. Here is an example:</li></ol><pre><code class="language-julia">logger = configure_logging(console_level=Logging.Debug)
InfrastructureSystems.set_group_level!(
    logger,
    InfrastructureSystems.LOG_GROUP_TIME_SERIES,
    Logging.Info,
)

# Or many at once.
InfrastructureSystems.set_group_levels!(
    logger,
    Dict(
        InfrastructureSystems.LOG_GROUP_SERIALIZATION =&gt; Logging.Info,
        InfrastructureSystems.LOG_GROUP_TIME_SERIES =&gt; Logging.Info,
    ),
)

# Get current settings
InfrastructureSystems.get_group_levels(logger)
InfrastructureSystems.get_group_level(logger, InfrastructureSystems.LOG_GROUP_TIME_SERIES)</code></pre><h3 id="Log-to-console-and-file-in-an-application-or-unit-test-environment"><a class="docs-heading-anchor" href="#Log-to-console-and-file-in-an-application-or-unit-test-environment">Log to console and file in an application or unit test environment</a><a id="Log-to-console-and-file-in-an-application-or-unit-test-environment-1"></a><a class="docs-heading-anchor-permalink" href="#Log-to-console-and-file-in-an-application-or-unit-test-environment" title="Permalink"></a></h3><p>Create a <code>MultiLogger</code> from <code>TerminalLoggers.TerminalLogger</code> and <code>Logging.SimpleLogger</code>. Use <code>open_file_logger</code> to guarantee that all messages get flushed to the file.</p><p>Note that you can use <code>Logging.ConsoleLogger</code> if you don&#39;t have <code>TerminalLoggers</code> installed.</p><p><strong>Example</strong> Multilogger configuration</p><pre><code class="language-julia">console_logger = TerminalLogger(stderr, Logging.Error)

open_file_logger(&quot;log.txt&quot;, Logging.Info) do file_logger
    multi_logger = MultiLogger([console_logger, file_logger])
    global_logger(multi_logger)

    do_stuff()
end</code></pre><p><strong>Note:</strong> If someone may execute the code in the REPL then wrap that code in a try/finally block and reset the global logger upon exit.</p><pre><code class="language-julia">function run_tests()
    console_logger = TerminalLogger(stderr, Logging.Error)

    open_file_logger(&quot;log.txt&quot;, Logging.Info) do file_logger
        multi_logger = MultiLogger([console_logger, file_logger])
        global_logger(multi_logger)

        do_stuff()
    end
end

logger = global_logger()

try
    run_tests()
finally
    # Guarantee that the global logger is reset.
    global_logger(logger)
    nothing
end</code></pre><h3 id="Suppress-frequent-messages"><a class="docs-heading-anchor" href="#Suppress-frequent-messages">Suppress frequent messages</a><a id="Suppress-frequent-messages-1"></a><a class="docs-heading-anchor-permalink" href="#Suppress-frequent-messages" title="Permalink"></a></h3><p>The standard Logging module in Julia provides a method to suppress messages. Tag the log message with maxlog = X.</p><pre><code class="language-julia">for i in range(1, length=100)
    @error &quot;something happened&quot; i maxlog = 2
end</code></pre><p>Only 2 messages will get logged.</p><p>The InfrastructureSystems logger provides a customization to make <code>maxlog</code> apply to a period of time instead of the duration of the Julia process.</p><p>In this example the suppression will timeout and two messages will get logged every five seconds. It will log how many log messages were suppressed on the first message that gets logged after a timeout.</p><pre><code class="language-julia">for i in range(1, length=100)
    @error &quot;something happened&quot; i maxlog = 2 _suppression_period = 5
    sleep(0.5)
end</code></pre><h3 id="Get-a-summary-of-log-messages"><a class="docs-heading-anchor" href="#Get-a-summary-of-log-messages">Get a summary of log messages</a><a id="Get-a-summary-of-log-messages-1"></a><a class="docs-heading-anchor-permalink" href="#Get-a-summary-of-log-messages" title="Permalink"></a></h3><p>By default a <code>MultiLogger</code> creates a <code>LogEventTracker</code> that keeps counts of all messages. Call <code>report_log_summary</code> after execution.</p><pre><code class="language-julia">logger = configure_logging(; filename=&quot;log.txt&quot;)
@info &quot;hello world&quot;

# Include a summary in the log file.
@info report_log_summary(logger)
close(logger)</code></pre><p>The output of the logger can be explored in the REPL:</p><pre><code class="language-julia">for i in range(1, length=100)
    @info &quot;hello&quot; maxlog = 2
    @warn &quot;beware&quot; maxlog = 2
end
@info report_log_summary(logger)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tests/">« Running Tests</a><a class="docs-footer-nextpage" href="../../style/">Style Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 4 January 2023 16:20">Wednesday 4 January 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
